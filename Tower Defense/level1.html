<html>
	<head>
		<title> Tower Defense </title>
		<script src="https://simplycodingcourses.com/files/simplyjs/simply.js"></script>
		<script>
			function start(){
				sjs.open("target",800,500);

				//Background Object and Properties
				var background = new sjs.Image("Images/background.jpg");
				background.setSize(2400,sjs.getHeight());

				var view = new sjs.Image("");
				view.setSize(800,500);
				view.moveTo(2400,500);

				sjs.scrollable(view,background);

				sjs.keyDown(LEFT_KEY, function(){
					view.pushLeft();
				});

				sjs.keyDown(RIGHT_KEY, function(){
					view.pushRight();
				});

				//Enemy
				var totalEnemies = 20;
				var enemyInterval = setInterval(function(){
					var enemy = new sjs.Image("Images/bad.gif");
					totalEnemies--;
					enemy.type = "enemy"; 
					enemy.moveTo(0,400);
					enemy.noBounds=true;
					enemy.setSize(65,65);
					enemy.friction = 0;	
					enemy.pushRight(3);
					if(totalEnemies <= 0){
						clearInterval(enemyInterval);
					}
				},1500);

				//Tracker
				var tracker = new sjs.Image("");
				tracker.type = "tracker";
				tracker.setSize(1,sjs.getHeight());
				tracker.moveTo(background.getWidth()/4,0);
				tracker.node.style.zIndex = -3;

				//Land
				var land = new sjs.Image("");
				land.type="land";
				land.setSize(background.getWidth(),50);
				land.moveTo(0,460);
				land.node.style.zIndex = -1;

				//Bolts
				bolts_text = new sjs.Text("Bolts Collected: "+bolts,18,"green");
				bolts_text.fixed = true;

				//OnHit Functions
				sjs.onHit("enemy","tracker",function(x,y){
					var warn = new sjs.Text("ENEMY APPROACHING!",20,"red"); warn.moveTo(view.x+100,sjs.getHeight()/2);
					y.destroy();
					setTimeout(function(){
						warn.destroy(); 
					},2500);
				});

				sjs.onHit(["blocker","gunman"],"land",function(x,y){
					sjs.stoppedBy(x,y); 
				});

				//Blocker
				sjs.onHit("blocker","enemy",function(x,y){
					y.moveTo(y.getX()-25,y.getY());
					x.lives--;
					if(x.lives==0){
						x.destroy();
					} 
				}); 

				//Gunman
				sjs.onHit("gunman","enemy",function(x,y){
					x.destroy();
					x.range.destroy();
				}); 

				sjs.onHit("range","enemy",function(x,y){ 
					if(x.fire == true){ 
						var gbullet = new sjs.Image("Images/bullet.png"); 
						gbullet.type="bullet";
						gbullet.moveTo(x.getX()+265,x.getY()+5);
						gbullet.setSize(32, 8);
						gbullet.friction=0;
						gbullet.pushLeft(6);
						gbullet.noBounds=true;
						x.fire = false;
						setTimeout(function(){
							gbullet.destroy();
							x.fire=true;
						},x.firerate);	
					} 
				});

				//Enemy
				var hits = totalEnemies;
				sjs.onHit("enemy","bullet",function(x,y){
					hits--;
					x.destroy();
					y.destroy();
					bolts += 10;
					bolts_text.setText("Bolts Collected: " + bolts); 
					if(hits <= 0){
						var nextLevel = new sjs.Button("Congratulations! Click to go to Level 2!", function(){
							window.location = "level2.html";
						});
						nextLevel.center();
					}
				});

				sjs.onHit("enemy","right_screen",function(x,y){
					window.location="gameover.html";
				});
 			}//End Function Start

 			var bolts = 100;
 			var bolts_text = "";
 			function blocker(){
 				if(bolts >= 30){
 					bolts -= 30;
 					bolts_text.setText("Bolts Collected: "+bolts);
					var blocker = new sjs.Image("Images/block.png");
					blocker.type = "blocker";
					blocker.setSize(65,65);
					blocker.center().offset(-sjs.gx,10);
					blocker.lives = 7;
					blocker.onMouseDown(function(){
						blocker.draggable();
						blocker.follow(sjs.mouse);
					});
					blocker.onMouseUp(function(){
						setTimeout(function(){
							blocker.undraggable();
						},100)
						blocker.unfollow(sjs.mouse);
						blocker.setGravity();
					});
				}else{
					var no_bolts = new sjs.Text("You're Too Poor! Collect More Bolts!",20,"red");
					no_bolts.center().offset(-sjs.gx,-200);
					setTimeout(function(){
						no_bolts.destroy(); 
					},2500);
				}
			}//End Function Blocker

			function gunman(){
				if(bolts >= 50){
					bolts -= 50;
					bolts_text.setText("Bolts Collected: "+bolts);
					var gunman = new sjs.Image("Images/gun.png"); 
					gunman.type = "gunman";
					gunman.setSize(65,65);
					gunman.center().offset(-sjs.gx,20);
					gunman.onMouseDown(function(){
						gunman.draggable();
						gunman.follow(sjs.mouse);
					});
					gunman.onMouseUp(function(){
						setTimeout(function(){
							gunman.undraggable();
						},100)
						gunman.unfollow(sjs.mouse);
						gunman.setGravity();
					});
					gunman.center().offset(-sjs.gx,20);
					var range = new sjs.Image("");
					range.type = "range";
					range.setSize(300,50);
					range.moveTo(gunman.getX()-300,gunman.getY()); 
					range.follow(gunman); 
					range.fire=true;
					range.firerate = 1500;
					range.node.style.zIndex = -2;
					gunman.range = range; 
				}else{
					var no_bolts = new sjs.Text("You're Too Poor! Collect More Bolts!",20,"red");
					no_bolts.center().offset(-sjs.gx,-200);
					setTimeout(function(){
						no_bolts.destroy(); 
					},2500);
				}
			}//End Function Gunman
		</script>
		<style>
			.images{
				height:50px;
				margin:15px;
			}
		</style>
	</head>
	<body onload = "start()">
		<center>
			<img src="Images/block.png" class="images" onclick="blocker()"> 
			<img src="Images/gun.png" class="images" onclick="gunman()"> 
			<br>
			<input type="button" value="30 Bolts!" onclick="blocker()">
			<input type="button" value="50 Bolts!" onclick="gunman()">
		</center>
		<div id="target" style="overflow:hidden; background-color:green; margin:auto;"></div>
	</body>
</html>
